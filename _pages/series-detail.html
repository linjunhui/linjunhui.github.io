---
layout: archive
title: "系列文章详情"
permalink: /series-detail/
author_profile: true
---

{% include base_path %}

{% comment %} 收集所有系列数据 {% endcomment %}
{% assign all_series = "" | split: "," %}
{% for post in site.posts %}
  {% if post.series %}
    {% unless all_series contains post.series %}
      {% assign all_series = all_series | push: post.series %}
    {% endunless %}
  {% endif %}
{% endfor %}

<div id="series-detail-container">
  {% comment %} 为每个系列生成一个内容块 {% endcomment %}
  {% for series_name in all_series %}
    {% assign series_posts = site.posts | where: "series", series_name | sort: "series_order" %}
    {% assign series_slug = series_name | slugify %}
    
    <div class="series-content" data-series="{{ series_name }}" style="display: none;">
      <div class="series-detail-header" style="margin-bottom: 2em; padding: 1.5em; background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); border-left: 4px solid #0066cc; border-radius: 6px;">
        <h1 style="margin-top: 0; color: #0066cc;">
          <i class="fa fa-book" aria-hidden="true"></i> {{ series_name }}
        </h1>
        <p style="color: #666; margin-bottom: 0;">
          <i class="fa fa-file-text-o" aria-hidden="true"></i> 共 {{ series_posts.size }} 篇文章
        </p>
      </div>
      
      <div class="series-posts-list">
        <ol style="list-style: none; padding: 0;">
          {% for post in series_posts %}
            <li style="margin-bottom: 2em; padding: 1.5em; background: white; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border-left: 4px solid #0066cc;">
              <div style="display: flex; align-items: flex-start; gap: 1em;">
                <div style="flex-shrink: 0; width: 40px; height: 40px; background: linear-gradient(135deg, #0066cc 0%, #004499 100%); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.1em;">
                  {{ post.series_order | default: forloop.index0 }}
                </div>
                
                <div style="flex: 1;">
                  <h2 class="archive__item-title" style="margin-top: 0; margin-bottom: 0.5em;">
                    <a href="{{ post.url | relative_url }}" style="color: #0066cc; text-decoration: none;">
                      {{ post.title }}
                    </a>
                  </h2>
                  
                  {% if post.excerpt %}
                    <p style="color: #666; line-height: 1.6; margin-bottom: 0.5em;">
                      {{ post.excerpt | markdownify | strip_html }}
                    </p>
                  {% endif %}
                  
                  <div style="display: flex; gap: 1.5em; font-size: 0.9em; color: #888; margin-top: 0.5em;">
                    {% if post.date %}
                      <span>
                        <i class="fa fa-calendar" aria-hidden="true"></i> 
                        {{ post.date | date: "%Y年%m月%d日" }}
                      </span>
                    {% endif %}
                    {% if post.read_time %}
                      <span>
                        <i class="fa fa-clock-o" aria-hidden="true"></i> 
                        {% include read-time.html %}
                      </span>
                    {% endif %}
                  </div>
                  
                  <div style="margin-top: 0.8em;">
                    <a href="{{ post.url | relative_url }}" class="btn btn--primary" style="display: inline-block; padding: 0.5em 1.2em; background: #0066cc; color: white; border-radius: 4px; text-decoration: none; transition: background 0.3s;">
                      阅读文章 <i class="fa fa-arrow-right" aria-hidden="true"></i>
                    </a>
                  </div>
                </div>
              </div>
            </li>
          {% endfor %}
        </ol>
      </div>
    </div>
  {% endfor %}
  
  {% comment %} 默认提示信息 {% endcomment %}
  <div id="series-loading" style="text-align: center; padding: 2em;">
    <p>正在加载系列文章...</p>
  </div>
  
  {% comment %} 错误提示 {% endcomment %}
  <div id="series-error" style="display: none; padding: 2em; background: #fff3cd; border: 1px solid #ffc107; border-radius: 6px;">
    <p style="color: #856404; font-weight: bold;">未找到指定的系列文章。</p>
    <p>请返回 <a href="{{ '/series/' | relative_url }}">合集列表</a>。</p>
  </div>
</div>

<script>
(function() {
  // 确保 DOM 加载完成后再执行
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initSeriesDetail);
  } else {
    initSeriesDetail();
  }
  
  function initSeriesDetail() {
    try {
      // 从 URL 查询参数中获取系列名称
      var urlParams = new URLSearchParams(window.location.search);
      var seriesName = urlParams.get('series');
      
      console.log('URL params:', window.location.search);
      console.log('Series name from URL:', seriesName);
      
      if (!seriesName) {
        var loadingEl = document.getElementById('series-loading');
        if (loadingEl) {
          loadingEl.innerHTML = '<p>未指定系列名称。请返回 <a href="{{ "/series/" | relative_url }}">合集列表</a>。</p>';
        }
        return;
      }
      
      // 解码 URL 编码
      var decodedSeriesName = seriesName;
      try {
        decodedSeriesName = decodeURIComponent(seriesName);
        console.log('Decoded series name:', decodedSeriesName);
      } catch(e) {
        console.log('Decode error:', e);
        // 如果解码失败，使用原始值
      }
      
      // 隐藏加载提示
      var loadingEl = document.getElementById('series-loading');
      if (loadingEl) {
        loadingEl.style.display = 'none';
      }
    
      // 查找匹配的系列内容块
      var seriesContents = document.querySelectorAll('.series-content');
      console.log('Found series content blocks:', seriesContents.length);
      
      var found = false;
      
      for (var i = 0; i < seriesContents.length; i++) {
        var content = seriesContents[i];
        var dataSeries = content.getAttribute('data-series');
        
        console.log('Comparing:', {
          'data-series': dataSeries,
          'seriesName': seriesName,
          'decodedSeriesName': decodedSeriesName
        });
        
        // 匹配系列名称（支持多种编码方式）
        var match = false;
        
        // 直接匹配
        if (dataSeries === seriesName || dataSeries === decodedSeriesName) {
          match = true;
          console.log('Direct match found!');
        } else {
          // 尝试 HTML 实体解码（如果被转义了）
          try {
            var tempDiv = document.createElement('div');
            tempDiv.innerHTML = dataSeries;
            var unescapedDataSeries = tempDiv.textContent || tempDiv.innerText || '';
            
            if (unescapedDataSeries === seriesName || unescapedDataSeries === decodedSeriesName) {
              match = true;
              console.log('Unescaped match found!');
            }
          } catch(e) {
            console.log('Unescape error:', e);
            // 解码失败，继续尝试其他方式
          }
        }
        
        if (match) {
          content.style.display = 'block';
          found = true;
          
          // 更新页面标题
          var h1El = content.querySelector('h1');
          if (h1El) {
            var seriesTitle = h1El.textContent.replace(/^\s*[^\s]+\s+/, '').trim();
            document.title = seriesTitle + ' - 系列文章详情';
          }
          console.log('Series content displayed!');
          break;
        }
      }
    
      // 如果没找到，显示错误信息
      if (!found) {
        var errorEl = document.getElementById('series-error');
        if (errorEl) {
          errorEl.style.display = 'block';
          var availableSeries = Array.from(seriesContents).map(function(c) {
            return c.getAttribute('data-series');
          });
          console.log('Series name from URL:', seriesName);
          console.log('Decoded series name:', decodedSeriesName);
          console.log('Available series:', availableSeries);
          console.log('Number of series found:', seriesContents.length);
          
          // 在页面上也显示调试信息
          var debugInfo = '<details style="margin-top: 1em;"><summary style="cursor: pointer;">调试信息</summary>';
          debugInfo += '<pre style="margin-top: 0.5em; padding: 1em; background: white; border-radius: 4px; overflow: auto;">';
          debugInfo += 'URL中的系列名称: ' + seriesName + '\n';
          debugInfo += '解码后的系列名称: ' + decodedSeriesName + '\n';
          debugInfo += '可用的系列: ' + availableSeries.join(', ') + '\n';
          debugInfo += '</pre></details>';
          errorEl.innerHTML += debugInfo;
        }
      }
    } catch(error) {
      console.error('Error in series detail script:', error);
      var loadingEl = document.getElementById('series-loading');
      if (loadingEl) {
        loadingEl.innerHTML = '<p style="color: red;">加载出错: ' + error.message + '</p><p>请返回 <a href="{{ "/series/" | relative_url }}">合集列表</a>。</p>';
      }
    }
  }
})();
</script>

<style>
  .series-posts-list a:hover {
    color: #004499 !important;
  }
  .series-posts-list .btn:hover {
    background: #004499 !important;
  }
</style>
